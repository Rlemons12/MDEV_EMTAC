<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill of Material Creation Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/create_bill_of_material_results.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/redbanner.css')}}">
</head>
<body>
    <div class="banner">
        THIS IS FOR REFERENCE ONLY. ALL INFORMATION SHOULD BE VERIFIED WITH CURRENT SOP'S
        <a href="#" id="commentPopupLink" style="color: #39FF14;">Leave a Comment</a>
    </div>
    <!-- Popup Modal Structure -->
    <div id="commentPopup" style="display: none;">
        <form id="commentForm">
            <h2>Leave a Comment</h2>
            <!-- Instructions for filling out the form -->
            <p>Instructions: You can write your comment, paste an image, or upload a file.</p>

            <!-- Comment box where users can paste an image or type text -->
            <textarea name="comment" id="comment" placeholder="Write your comment here..." required></textarea><br>

            <!-- Hidden field to store base64 image data -->
            <input type="hidden" id="imageData" name="imageData">

            <!-- Display an indicator or preview if an image was pasted -->
            <div id="pastedImageFeedback" style="display: none; color: green;">
                Image snippet successfully added!
            </div>
            <img id="pastedImagePreview" src="" alt="Pasted Image Preview" style="display:none; max-width: 100px; margin-top: 10px;" />

            <!-- Option to upload a file -->
            <label for="fileUpload">Or upload an image:</label><br>
            <input type="file" id="fileUpload" name="screenshot" accept="image/*" /><br><br>

            <button type="submit">Send</button>
            <button type="button" id="closePopup">Close</button>
        </form>
    </div>

    <div class="container"> <!-- Added container div for layout control -->
        <!-- Header Info (optional, if needed) -->
        <div class="header-info">
            <h1>
                {% if model_name %}
                    Model: {{ model_name }}
                {% endif %}
                {% if asset_number %}
                    | Asset Number: {{ asset_number }}
                {% endif %}
                {% if location_name %}
                    | Location: {{ location_name }}
                {% endif %}
            </h1>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Part Number</th>
                    <th>Description</th>
                    <th>OEM Manufacturer</th>
                    <th>Model</th>
                    <th>Class Flag</th>
                    <th>UD6</th>
                    <th>Type</th>
                    <th>Notes</th>
                    <th>Documentation</th>
                    <th>Image</th>
                </tr>
            </thead>
            <tbody>
                {% for item in parts_and_images %}
                <tr>
                    <td>{{ item.part.part_number }}</td>
                    <td>{{ item.part.name }}</td>
                    <td>{{ item.part.oem_mfg }}</td>
                    <td>{{ item.part.model }}</td>
                    <td>{{ item.part.class_flag }}</td>
                    <td>{{ item.part.ud6 }}</td>
                    <td>{{ item.part.type }}</td>
                    <td>{{ item.part.notes }}</td>
                    <td>{{ item.part.documentation }}</td>
                    <td>
                        {% if item.image %}
                            <a href="{{ url_for('create_bill_of_material_bp.bom_serve_image_route', image_id=item.image.id) }}" target="_blank">
                                <img class="thumbnail" src="{{ url_for('create_bill_of_material_bp.bom_serve_image_route', image_id=item.image.id) }}" alt="{{ item.image.title }}" />
                            </a>
                        {% else %}
                            <p>No image available</p>
                            <!-- Optionally, you can display a placeholder image -->
                            <!-- <img class="thumbnail" src="{{ url_for('static', filename='images/placeholder.png') }}" alt="No Image Available" /> -->
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination, Items Per Page Selector, and Page Jump -->
        <div class="pagination">
            <form method="GET" action="{{ url_for('create_bill_of_material_bp.view_bill_of_material') }}" style="display: inline;">
                <label for="per_page">Items per page:</label>
                <select id="per_page" name="per_page" onchange="this.form.submit()">
                    <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
                    <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                    <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                </select>
                <input type="hidden" name="index" value="{{ index }}">
            </form>

            {% if prev_index is not none %}
                <a href="{{ url_for('create_bill_of_material_bp.view_bill_of_material', index=prev_index, per_page=per_page) }}">Previous</a>
            {% endif %}

            <!-- Page Jump Selector -->
            <form method="GET" action="{{ url_for('create_bill_of_material_bp.view_bill_of_material') }}" style="display: inline;">
                <label for="jump_to_page">Jump to page:</label>
                <select id="jump_to_page" name="index" onchange="this.form.submit()">
                    {% for i in range(0, total, per_page) %}
                    <option value="{{ i }}" {% if index == i %}selected{% endif %}>{{ i // per_page + 1 }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="per_page" value="{{ per_page }}">
            </form>

            {% if next_index is not none %}
                <a class="next" href="{{ url_for('create_bill_of_material_bp.view_bill_of_material', index=next_index, per_page=per_page) }}">Next</a>
            {% endif %}
        </div>

        <a class="back-to-form" href="{{ url_for('bill_of_materials') }}">Back to Search</a>

    </div>
    <script src="{{ url_for('static', filename='js/comment_pop_up.js')}}"></script>
</body>
</html>
