{% extends "module_template_html/base_template.html" %}

{% block title %}Bill of Material Creation Results{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/create_bill_of_material_results.css') }}">
{% endblock %}

{% block content %}
    <div class="container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Header Info -->
        <div class="header-info">
            <h1>Bill of Material Results</h1>
            {% if session.get('model_id') %}<p><strong>Model ID:</strong> {{ session.get('model_id') }}</p>{% endif %}
            {% if session.get('asset_number_id') %}<p><strong>Asset Number ID:</strong> {{ session.get('asset_number_id') }}</p>{% endif %}
            {% if session.get('location_id') %}<p><strong>Location ID:</strong> {{ session.get('location_id') }}</p>{% endif %}
            {% if session.get('general_asset_number') %}<p><strong>Asset Number:</strong> {{ session.get('general_asset_number') }}</p>{% endif %}
            {% if session.get('general_location') %}<p><strong>Location:</strong> {{ session.get('general_location') }}</p>{% endif %}
        </div>

        <!-- Back to Search -->
        <a class="back-to-form" href="{{ url_for('create_bill_of_material_bp.create_bill_of_material') }}">Back to Search</a>

        {% if parts_and_images %}
            <div class="table-container">
            <table>
                <thead>…</thead>
                <tbody>
                    {% for item in parts_and_images %}
                    <tr>
                        <td>{{ item.part.part_number }}</td>
                        …
                        <td>
                            {% if item.image %}
                                <a href="{{ url_for('create_bill_of_material_bp.bom_serve_image_route', image_id=item.image.id) }}" target="_blank">
                                  <img class="thumbnail" src="{{ url_for('create_bill_of_material_bp.bom_serve_image_route', image_id=item.image.id) }}" alt="{{ item.image.title }}">
                                </a>
                            {% else %}
                                <p>No image available</p>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <form id="per-page-form" method="GET" action="{{ url_for('create_bill_of_material_bp.view_bill_of_material') }}">
                    <label for="per_page">Items per page:</label>
                    <select id="per_page" name="per_page">
                        <option value="4"{% if per_page==4 %} selected{% endif %}>4</option>
                        …
                    </select>
                    <input type="hidden" name="index" value="{{ index }}">
                </form>

                {% if prev_index %}<a href="{{ url_for('create_bill_of_material_bp.view_bill_of_material', index=prev_index, per_page=per_page) }}">Previous</a>{% endif %}
                …
                {% if next_index %}<a class="next" href="{{ url_for('create_bill_of_material_bp.view_bill_of_material', index=next_index, per_page=per_page) }}">Next</a>{% endif %}
            </div>
        {% else %}
            <div class="no-results">
                <p>No results found. Please refine your search.</p>
            </div>
        {% endif %}

        <a class="back-to-form" href="{{ url_for('create_bill_of_material_bp.create_bill_of_material') }}">Back to Search</a>
    </div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/bill_of_materials/bill_of_materials.js') }}"></script>
<script src="{{ url_for('static', filename='js/get_bill_of_material_query.js') }}"></script>
{% endblock %}
