<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill of Materials</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/search_bill_of_material.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bill_of_materials.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css')}}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="banner">
        THIS IS FOR REFERENCE ONLY. ALL INFORMATION SHOULD BE VERIFIED WITH CURRENT SOP'S
        <a href="#" id="commentPopupLink" style="color: #39FF14;">Leave a Comment</a>
    </div>

    <!-- Popup Modal Structure -->
    <div id="commentPopup" style="display: none;">
        <form id="commentForm">
            <h2>Leave a Comment</h2>
            <p>Instructions: You can write your comment, paste an image, or upload a file.</p>
            <textarea name="comment" id="comment" placeholder="Write your comment here..." required></textarea><br>
            <input type="hidden" id="imageData" name="imageData">
            <div id="pastedImageFeedback" style="display: none; color: green;">
                Image snippet successfully added!
            </div>
            <img id="pastedImagePreview" src="" alt="Pasted Image Preview" style="display:none; max-width: 100px; margin-top: 10px;" />
            <label for="fileUpload">Or upload an image:</label><br>
            <input type="file" id="fileUpload" name="screenshot" accept="image/*" /><br><br>
            <button type="submit">Send</button>
            <button type="button" id="closePopup">Close</button>
        </form>
    </div>

    <!-- Sidebar and Menu -->
    <div class="hamburger" id="hamburger">&#9776;</div>
    <div class="sidebar" id="sidebar">
        <button class="toggle-btn" onclick="toggleSidebar()">Toggle Sidebar</button>
        <h2>Menu</h2>
        {% if session['user_level'] == 'ADMIN' or session['user_level'] == 'LEVEL_III' %}
            <a href="/static" style="color:  #FFFFFF;">Return to Main Page</a>
        {%  endif %}
        <a href="#search-bill-of-materials" onclick="showForm('search-bill-of-materials')">Search Bill of Materials</a>
        <a href="#upload-bill-of-materials" onclick="showForm('upload-bill-of-materials')">Upload Bill of Materials</a>
        {% if session['user_level'] == 'ADMIN' or session['user_level'] == 'LEVEL_III' %}
            <a href="#1enter-new-part-number" onclick="showForm('1enter-new-part-number')">Enter New Part</a>
            <a href="#edit-part" onclick="showForm('edit-part')" >Edit Part</a>
            <!-- New link to open Position Data Assignment page -->
            <a href="/position_data_assignment" style="color: #39FF14;">To Position data Assignment</a>
            <a href="/upload_search_database" style="color: #39FF14;" class="upload-button">To Search and Upload</a>
            <a href="/troubleshooting_guide" style="color: #39FF14;">To Update Troubleshooting Guide</a>
            <!-- New link to open Edit Part form -->

        {% endif %}
        <a href="/logout" style="color:  #FF5F1F;" class="logout-button">Logout</a>
    </div>

    <!-- Content Wrapper -->
    <div class="content-wrapper">
        <!-- Main Container for the BOM Search -->
        <div id="search-bill-of-materials" class="form-container">
            <h1>Parts Search By Used On</h1>
            <!-- Button to toggle the collapsible form -->
            <button type="button" id="toggleFormBtn" style="background-color: #007bff; color: #fff; padding: 10px 20px;">
                Toggle Advanced Search (Area, Equipment Group, Model)
            </button>
            <!-- Collapsible Form: Advanced Search -->
            <div id="advancedSearchForm" style="display: none; margin-top: 15px;">
                <form method="POST" action="{{ url_for('create_bill_of_material_bp.create_bill_of_material') }}">
                    <div style="margin-bottom: 15px;">
                        <label for="filter_areaDropdown" style="color: Yellow;">Area:</label>
                        <select name="area" id="filter_areaDropdown" style="width: 100%; max-width: 600px;"></select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label for="filter_equipmentGroupDropdown" style="color: Yellow;">Equipment Group:</label>
                        <select name="equipment_group" id="filter_equipmentGroupDropdown" style="width: 100%; max-width: 600px;"></select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label for="filter_modelDropdown" style="color: Yellow;">Model:</label>
                        <select name="model" id="filter_modelDropdown" style="width: 100%; max-width: 600px;"></select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label for="filter_assetNumberDropdown" style="color: Yellow;">Asset Number:</label>
                        <select name="asset_number" id="filter_assetNumberDropdown" style="width: 100%; max-width: 600px;"></select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label for="filter_locationDropdown" style="color: Yellow;">Location:</label>
                        <select name="location" id="filter_locationDropdown" style="width: 100%; max-width: 600px;"></select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <input type="submit" value="Filter" style="background-color: #007bff; color: #fff; padding: 10px 20px;">
                    </div>
                </form>
            </div>

            <!-- General Search Box -->
            <div id="generalSearch" style="margin-top: 30px;">
                <h3>Quick Search by Asset Number or Location</h3>
                <form method="POST" action="{{ url_for('create_bill_of_material_bp.bom_general_search') }}">
                    <div style="margin-bottom: 15px;">
                        <label for="general_assetNumber" style="color: Yellow;">Asset Number:</label>
                        <input type="text" id="general_assetNumber" name="general_asset_number" placeholder="Type Asset Number" style="width: 100%; max-width: 600px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label for="general_location" style="color: Yellow;">Location:</label>
                        <input type="text" id="general_location" name="general_location" placeholder="Type Location" style="width: 100%; max-width: 600px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <input type="submit" value="Search" style="background-color: #007bff; color: #fff; padding: 10px 20px;">
                    </div>
                </form>
            </div>
        </div>

        <!-- Upload Bill of Materials Form -->
        <div id="upload-bill-of-materials" class="form-container">
            <h2>Upload Bill of Materials</h2>
            <form id="upload-bom-form" action="/bill_of_materials" method="post" enctype="multipart/form-data">
                <label for="area" style="color: Yellow;">Area:</label>
                <select name="area" id="bom_areaDropdown"></select><br>
                <label for="equipment_group" style="color: Yellow;">Equipment Group:</label>
                <select name="equipment_group" id="bom_equipmentGroupDropdown"></select><br>
                <label for="model" style="color: Yellow;">Model:</label>
                <select name="model" id="bom_modelDropdown"></select><br>
                <label for="asset_number" style="color: Yellow;">Asset Number:</label>
                <select name="asset_number" id="bom_assetNumberDropdown"></select><br>
                <label for="location" style="color: Yellow;">Location:</label>
                <select name="location" id="bom_locationDropdown"></select><br>
                <label for="image_path" style="color: Yellow;">Image Path:</label>
                <input type="text" name="image_path" id="image_path"><br>
                <input type="file" name="file" required><br>
                <input type="submit" value="Upload">
            </form>
        </div>

        <!-- Enter New Part Form -->
        <div id="1enter-new-part-number" class="form-container">
            {% include 'bill_of_materials/bom_partials/enter_new_part.html' %}
        </div>

    <div class="content-wrapper">
    <!-- Search and Edit Part Form -->
    <div id="edit-part" class="form-container">
        <h1>Search and Edit Part</h1>

        <!-- Search form for finding a part -->
        <form action="{{ url_for('update_part_bp.search_part') }}" method="GET">
            <label for="search_query">Search by Part Number, Name, OEM Manufacturer, or Model:</label>
            <input type="text" id="search_query" name="search_query" placeholder="Type your search here..." required><br>
            <input type="submit" value="Search">
        </form>

        <!-- Display part options if search results are available -->
        {% if parts %}
        <form action="{{ url_for('update_part_bp.edit_part') }}" method="POST">
            <label for="part_id">Select Part to Edit:</label>
            <select name="part_id" id="part_id" required>
                {% for part in parts %}
                    <option value="{{ part.id }}">{{ part.part_number }} - {{ part.name }} ({{ part.oem_mfg }})</option>
                {% endfor %}
            </select><br>
            <input type="submit" value="Edit Selected Part">
        </form>
        {% endif %}

        <!-- Include the edit part form partial -->
        {% include '/bill_of_materials/bom_partials/edit_part.html' %}
    </div>
</div>



        <!-- Flash Messages -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div style="margin-top: 20px; padding: 10px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px;">
                    <ul>
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% endwith %}
    </div>

<script>
    // Toggle sidebar collapse
    function toggleSidebar() {
        var sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('collapsed');
    }

    // Show specific form based on the formId and hide the others
    function showForm(formId) {
        var forms = document.getElementsByClassName('form-container');
        for (var i = 0; i < forms.length; i++) {
            forms[i].style.display = 'none';  // Hide all forms
        }
        document.getElementById(formId).style.display = 'block';  // Show the selected form
    }

    // Toggle visibility of advanced search form
    function toggleAdvancedSearch() {
        var advancedForm = document.getElementById('advancedSearchForm');
        if (advancedForm.style.display === "none" || advancedForm.style.display === "") {
            advancedForm.style.display = "block";
        } else {
            advancedForm.style.display = "none";
        }
    }

    // Event listeners after DOM content is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Hide all forms initially, and display default (search-bill-of-materials) form
        var forms = document.getElementsByClassName('form-container');
        for (var i = 0; i < forms.length; i++) {
            forms[i].style.display = 'none';
        }
        document.getElementById('search-bill-of-materials').style.display = 'block'; // Default form

        // Event listener for the advanced search toggle button
        var toggleButton = document.getElementById('toggleFormBtn');
        if (toggleButton) {
            toggleButton.addEventListener('click', toggleAdvancedSearch);
        }
    });

    // Listener for hash changes (to show the correct form based on URL hash)
    window.addEventListener('hashchange', function() {
        var hash = window.location.hash.substring(1); // Remove '#' symbol
        if (hash) {
            showForm(hash);  // Show form based on hash in URL
        }
    });
</script>

<!-- External scripts -->
<script src="{{ url_for('static', filename='js/get_bill_of_material_query.js') }}"></script>
<script src="{{ url_for('static', filename='js/bill_of_materials.js') }}"></script>
<script src="{{ url_for('static', filename='js/comment_pop_up.js') }}"></script>
<script src="{{ url_for('static', filename='js/base_sidebar.js') }}"></script>

</body>
</html>
